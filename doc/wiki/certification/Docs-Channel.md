# AliOS Things 通道测试规范
* [MQTT 通道测试规范](#mqtt)
* [WSF 通道测试规范](#wsf)
* [LinkKit 通道测试规范](#linkkit)
* [CoAP 通道测试规范](#coap)


<a id='mqtt'></a>

## MQTT 通道测试规范

### 设备认证

| 测试用例编号 | AOS-3-16                                                                |
|--------------|-------------------------------------------------------------------------|
| 测试用例     | 设备认证                                                                |
| 测试目的     | 验证设备认证后获取iotid与iottoken                                       |
| 测试属性     | 必选 \| P0 \| 功能用例                                                  |
| 测试设备     | 1.设备，2.串口线，3.PC                                                  |
| 测试拓扑结构 | 一个设备串口连接PC                                                      |
| 测试预置条件 | 设备联网成功                                                            |
| 测试步骤     | 设备尝试通过HTTPS/MQTT/ID2认证                                          |
| 预期结果     | 设备所支持的认证方式认证通过，拿到iotid和iottoken并且成功连接MQTT服务器 |
| 备注         | 认证方式有HTTPS认证/MQTT直连认证/ID2认证，设备可选支持其中一种或多种    |

### MQTT通道连接

| 测试用例编号 | AOS-3-17                                                                                                        |
|--------------|-----------------------------------------------------------------------------------------------------------------|
| 测试用例     | MQTT通道连接                                                                                                    |
| 测试目的     | 验证设备连接MQTT服务器                                                                                          |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                          |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                          |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                              |
| 测试预置条件 | \- 设备联网成功 <br>- 设备认证通过并获得iotid与iottoken                                                       |
| 测试步骤     | \- 设备连接设备MQTT服务器                                                                                       |
| 预期结果     | \- 设备连接MQTT服务成功，设备状态变为在线 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                 |

### 设备订阅topic

| 测试用例编号 | AOS-3-18                                                                                                                             |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备订阅topic                                                                                                                        |
| 测试目的     | 验证设备连接成功后订阅topic的能力                                                                                                    |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                               |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                   |
| 测试预置条件 | \- 设备联网 <br>- 设备认证通过并连接至MQTT服务器                                                                                   |
| 测试步骤     | \- 设备订阅topic A，保持在线状态 <br>- web页面向该设备的topic A 发布一条消息                                                       |
| 预期结果     | \- 设备接收到topic A的一条消息并且消息内容与页面填写的内容相同 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                                      |

### 设备发布topic

| 测试用例编号 | AOS-3-19                                                                                                                                  |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备发布topic                                                                                                                             |
| 测试目的     | 验证设备连接成功后主动发布topic的能力                                                                                                     |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                    |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                    |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                        |
| 测试预置条件 | \- 设备联网 <br>- 设备认证通过并连接至MQTT服务器                                                                                        |
| 测试步骤     | \- 设备向topic A发布一条消息                                                                                                              |
| 预期结果     | \- 设备发布消息成功，服务日志查询的消息内容与设备发布的消息内容相同 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                                           |

### 设备取消订阅topic

| 测试用例编号 | AOS-3-20                                                                                                                                                                                                                   |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备取消订阅topic                                                                                                                                                                                                          |
| 测试目的     | 验证设备取消订阅topic后通信正常                                                                                                                                                                                            |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                                                                                                     |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                                                                                     |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                                                                         |
| 测试预置条件 | \- 设备联网 <br>- 设备认证通过并连接至MQTT服务器                                                                                                                                                                         |
| 测试步骤     | \- 设备订阅topic A，并保持在线状态 <br>- web页面向该设备topic A发布消息 <br>- 设备取消订阅topicA，并保持在线状态 <br>- web页面向该设备topic A发布消息                                                                |
| 预期结果     | \- 设备订阅topic A成功 <br>- 步骤2执行后，设备接收到topic A的消息，消息内容与页面发布的消息内容相同 <br>- 步骤4执行后，设备接收不到topic A的消息 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                                                                                                                            |

### 设备心跳

| 测试用例编号 | AOS-3-21                                                                                                        |
|--------------|-----------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备心跳                                                                                                        |
| 测试目的     | 验证设备保持在线心跳机制完备                                                                                    |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                          |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                          |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                              |
| 测试预置条件 | \- 设备联网 <br>- 设备认证通过并连接至MQTT服务器                                                              |
| 测试步骤     | \- 设备保持在线状态不断开连接 <br>- 观察设备端日志                                                            |
| 预期结果     | \- 设备以心跳为周期向MQTT服务器发送心跳包 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 心跳周期为用户设置，测试前需确定心跳周期                                                                        |

### 设备反复认证与连接

| 测试用例编号 | AOS-3-22                                                                                           |
|--------------|----------------------------------------------------------------------------------------------------|
| 测试用例     | 设备反复认证与连接                                                                                 |
| 测试目的     | 验证设备反复认证与连接稳定性                                                                       |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                           |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                 |
| 测试预置条件 | \- 设备联网                                                                                        |
| 测试步骤     | \- 设备认证 <br>- 认证成功后，设备建立MQTT连接 <br>- 设备断开MQTT连接 <br>- 步骤1\~3重复1W次 |
| 预期结果     | \- 认证与建立连接成功率99.9% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                    |

### QoS1低频消息测试

| 测试用例编号 | AOS-3-23                                                                                                                                                                        |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | QoS1低频消息测试                                                                                                                                                                |
| 测试目的     | 验证设备低频通信稳定性                                                                                                                                                          |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                                                        |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                                          |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                              |
| 测试预置条件 | \- 设备联网                                                                                                                                                                     |
| 测试步骤     | \- 设备认证连接，并保持在线状态 <br>- 设备订阅topic A，在topic A回调函数中将接收到的消息转发到topic B <br>- 使用压测工具以500ms周期向topic A发送消息，并统计topic B消息数量 |
| 预期结果     | \- 12小时稳定工作，无离线 <br>- 丢包率≤0.5% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                                             |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                                                                                         |

### QoS1高频消息测试

| 测试用例编号 | AOS-3-24                                                                                                                                                                        |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | QoS1高频消息测试                                                                                                                                                                |
| 测试目的     | 验证设备高频通信稳定性                                                                                                                                                          |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                                                        |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                                          |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                              |
| 测试预置条件 | \- 设备联网                                                                                                                                                                     |
| 测试步骤     | \- 设备认证连接，并保持在线状态 <br>- 设备订阅topic A，在topic A回调函数中将接收到的消息转发到topic B <br>- 使用压测工具以200ms周期向topic A发送消息，并统计topic B消息数量 |
| 预期结果     | \- 12小时稳定工作，无离线 <br>- 丢包率≤1% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                                               |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                                                                                         |

### 长时间稳定通信

| 测试用例编号 | AOS-3-25                                                                                                                                              |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间稳定通信                                                                                                                                        |
| 测试目的     | 验证设备长时间稳定工作                                                                                                                                |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                              |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                    |
| 测试预置条件 | \- 设备联网                                                                                                                                           |
| 测试步骤     | \- 设备认证连接，并保持在线状态                                                                                                                       |
| 预期结果     | \- 5x24小时稳定工作 <br>- 离线次数＜4次 <br>- 单次离线时间不超过1个心跳周期 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                                                               |

### 大数据包稳定通信

| 测试用例编号 | AOS-3-26                                                                                                                                                                                  |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 大数据包稳定通信                                                                                                                                                                          |
| 测试目的     | 验证设备大数据包稳定通信                                                                                                                                                                  |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                                                                  |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                                                    |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                                        |
| 测试预置条件 | \- 设备联网                                                                                                                                                                               |
| 测试步骤     | \- 设备认证连接，并保持在线状态 <br>- 设备订阅topic A，在topic A回调函数中将接收到的消息转发到topic B <br>- 使用压测工具以500ms周期向topic A发送2000字节的消息，并统计topic B消息数量 |
| 预期结果     | \- 1小时稳定工作 <br>- 丢包率≤0.5% <br>- 重连次数≤1次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                                           |
| 备注         | \- 2000字节可以根据设备实际能力调整                                                                                                                                                       |

### 断网发现与重连

| 测试用例编号 | AOS-3-27                                                                                                                                                             |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 断网发现与重连                                                                                                                                                       |
| 测试目的     | 验证设备断网发现与重连的能力                                                                                                                                         |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                   |
| 测试预置条件 | \- 设备联网                                                                                                                                                          |
| 测试步骤     | \- 设备认证连接，并保持在线状态（维持心跳） <br>- 待连接稳定后，断开网络 <br>- 断网状态维持3个心跳周期的时间后恢复网络连接 <br>- 1个心跳周期后观察设备在线状态 |
| 预期结果     | \- 断网后3个心跳周期内发现断网并尝试重连 <br>- 网络恢复后1个心跳周期内设备重连成功 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常           |
| 备注         |                                                                                                                                                                      |

<a id='wsf'></a>
## WSF 通道测试规范

### 设备注册与登录

| 测试用例编号 | AOS-3-1                                                                                                                                                              |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备注册与登录                                                                                                                                                       |
| 测试目的     | 验证设备是否支持注册、登录逻辑                                                                                                                                       |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                                               |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                                   |
| 测试预置条件 | 设备联网                                                                                                                                                             |
| 测试步骤     | 设备注册、登录成功并保持在线状态                                                                                                                                   |
| 预期结果     | \- 注册成功、登录成功 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                                                               |
| 备注         | \- alink1.0 注册接口： registerDevice； <br>- alink1.1 注册接口： device.registerByAuthToken。 <br>- alink1.0 登录接口： LoginDevice； <br>- alink1.1 登录接口： device.login |

### 设备UUID持久化

| 测试用例编号 | AOS-3-2                                                                                                                              |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备UUID持久化                                                                                                                       |
| 测试目的     | 验证设备注册后持久化存储UUID，在断开连接、上电重启后不再注册                                                                         |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                               |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                   |
| 测试预置条件 | \- 设备联网                                                                                                                          |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 断开网络使设备离线 <br>- 恢复网络使设备上线 <br>- 设备掉电重启，网络保持正常使设备上线                      |
| 预期结果     | \- 断网后设备连线重连不出现注册行为 <br>- 设备掉电重启后不出现注册行为 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                                      |

### 设备响应下行命令及上报状态

| 测试用例编号 | AOS-3-3                                                                                                      |
|--------------|--------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备响应下行命令及上报状态                                                                                   |
| 测试目的     | 验证设备是否能正常响应云平台的下行命令， 并上报设备状态                                                      |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                       |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                       |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                           |
| 测试预置条件 | 设备联网                                                                                                     |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 设备模拟上报数据 <br>- 通过APP或者web下行控制设备命令                            |
| 预期结果     | \- 设备正确上报状态 <br>- 设备正确响应下行命令 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                              |

### 设备主动上报状态

| 测试用例编号 | AOS-3-4                                                                                                           |
|--------------|-------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备主动上报状态                                                                                                  |
| 测试目的     | 验证设备是否支持主动上报设备状态，上电后第一次上报是否支持上报完整的状态                                          |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                            |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                            |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                |
| 测试预置条件 | 设备联网                                                                                                          |
| 测试步骤     | \- 设备上电等待连接成功后，查看设备上报数据 <br>- 断网后恢复连接后，查看设备上报数据 <br>- 重新联网后，查看设备上报数据 |
| 预期结果     | \- 步骤1\~3设备上报所有属性值 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                    |
| 备注         |                                                                                                                   |

### 设备恢复出厂设置

| 测试用例编号 | AOS-3-5                                                                                                      |
|--------------|--------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备恢复出厂设置                                                                                             |
| 测试目的     | 设备原厂恢复功能                                                                                             |
| 测试属性     | 可选 \| P0 \| 功能用例                                                                                       |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                       |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                           |
| 测试预置条件 | \- 设备联网                                                                                                  |
| 测试步骤     | \- 设备上电，连接成功并保持心跳 <br>- 对设备进行硬件或软件恢复出厂设置 <br>- 设备上电重连，查看设备与账号绑定关系  |
| 预期结果     | \- 设备恢复出厂设置，账号与设备绑定关系解除 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                              |

### 设备透传

| 测试用例编号 | AOS-3-6                                                                                                            |
|--------------|--------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备透传                                                                                                           |
| 测试目的     | 验证设备是否支持指令透传模式                                                                                       |
| 测试属性     | 可选 \| P0 \| 功能用例                                                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                 |
| 测试预置条件 | \- 设备联网                                                                                                        |
| 测试步骤     | <br>- 设备上电，连接成功并保持心跳 <br>- 设备模拟上报二进制数据 <br>- APP或web模拟发送数据到设备端                          |
| 预期结果     | \- 设备成功上报二进制数据也能接收到接收到模拟数据 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                    |

### 设备上报状态时延

| 测试用例编号 | AOS-3-7                                                                                                                                   |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备上报状态时延                                                                                                                          |
| 测试目的     | 验证设备功能或状态发生改变时，及时上报变更后的属性数据到服务 端，如：用户通过 APP 调节空调温度，调节成功后，温度值应该即时 上报到服务端。 |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                    |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                    |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                        |
| 测试预置条件 | \- 设备联网                                                                                                                               |
| 测试步骤     | \- 设备上电，连接成功并保持心跳 <br>- 通过APP下发控制命令改变设备属性值，查看 log，确认设备从收到控制指令到上报该属性到服务端时长            |
| 预期结果     | \- 设备从收到控制指令到上报属性到服务端时延≤1s <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                           |
| 备注         |                                                                                                                                           |

### 低频指令测试

| 测试用例编号 | AOS-3-8                                                                                                            |
|--------------|--------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 低频指令测试                                                                                                       |
| 测试目的     | 验证设备低频通信稳定性                                                                                             |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                           |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                 |
| 测试预置条件 | \- 设备联网                                                                                                        |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 使用压测工具以500ms为周期向设备发送消息                                             |
| 预期结果     | \- 12小时稳定工作，无断线 <br>- 指令响应成功率≥99.9% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                            |

### 高频指令测试

| 测试用例编号 | AOS-3-9                                                                                                          |
|--------------|------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 高频指令测试                                                                                                     |
| 测试目的     | 验证设备高频通信稳定性                                                                                           |
| 测试属性     | 可选 \| P0 \| 稳定性用例                                                                                         |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                           |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                               |
| 测试预置条件 | \- 设备联网                                                                                                      |
| 测试步骤     | \- 设备连接，并保持在线状态 <br>- 使用压测工具以200ms为周期向设备发送消息                                           |
| 预期结果     | \- 12小时稳定工作，无断线 <br>- 指令响应成功率≥98% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                          |

### 长时间稳定工作

| 测试用例编号 | AOS-3-10                                                                                                                   |
|--------------|----------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间稳定工作                                                                                                             |
| 测试目的     | 验证设备ALink长时间稳定工作                                                                                                |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                   |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                     |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                         |
| 测试预置条件 | 设备联网                                                                                                                   |
| 测试步骤     | 设备认证连接，在线保持心跳                                                                                                 |
| 预期结果     | \- 5x24小时稳定工作 <br>- 离线次数＜4次 <br>- 单次离线时间≤60秒 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 压测工具及使用见 “AliOS Things认证指南”                                                                                    |

### 长时间断网后恢复连接能力

| 测试用例编号 | AOS-3-11                                                                                                         |
|--------------|------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间断网后恢复连接能力                                                                                         |
| 测试目的     | 验证设备ALink长时间断网后自动恢复连接的能力                                                                      |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                         |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                           |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                               |
| 测试预置条件 | 设备联网                                                                                                         |
| 测试步骤     | \- 设备认证连接，在线保持心跳 <br>- 稳定后断开网络连接（AP断电） <br>- 12小时后AP上电                                  |
| 预期结果     | \- 检测到网络断开 <br>- 网络恢复后自动恢复连接能力 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                  |

### 长时间断网后恢复业务能力

| 测试用例编号 | AOS-3-12                                                                                                                                            |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间断网后恢复业务能力                                                                                                                            |
| 测试目的     | 验证设备ALink长时间断网后自动恢复连接的能力                                                                                                         |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                                                            |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                              |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                  |
| 测试预置条件 | 设备联网                                                                                                                                            |
| 测试步骤     | \- 设备认证连接，在线保持心跳 <br>- 稳定后断开网络连接（断开AP端WAN网络） <br>- 12小时后后恢复网络（连接AP端WAN网络） <br>- 恢复连接后使用在线工具下发数据包 |
| 预期结果     | \- 检测到网络断开 <br>- 网络恢复后自动恢复连接能力 <br>- 网络恢复后能正常收发数据包 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常      |
| 备注         |                                                                                                                                                     |

### 支持无缝切换AP能力

| 测试用例编号 | AOS-3-13                                                                                                                                   |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 支持无缝切换AP能力                                                                                                                         |
| 测试目的     | 验证更改AP后，在SSID与无线密码不变的情况，自动恢复连接能力                                                                                 |
| 测试属性     | 必选 \| P1 \| 功能用例                                                                                                                     |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                     |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                         |
| 测试预置条件 | 设备联网                                                                                                                                   |
| 测试步骤     | \- 手机连接AP1网络，联网设备，此时设备连接到AP1 <br>- 关闭AP1电源，此时设备出现断网状态，然后接通AP2（无线SSID与无线密钥，与AP1保持一致）电源 |
| 预期结果     | \- 检测到网络断开 <br>- 设备连接到AP2并重连保持在线状态 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                      |
| 备注         |                                                                                                                                            |

### 超长数据包接收处理能力

| 测试用例编号 | AOS-3-14                                                                                                                                              |
|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 超长数据包接收处理能力                                                                                                                                |
| 测试目的     | 验证更改AP后，在SSID与无线密码不变的情况，自动恢复连接能力                                                                                            |
| 测试属性     | 必选 \| P1 \| 功能用例                                                                                                                                |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                                |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                                    |
| 测试预置条件 | 设备联网并连接物联平台                                                                                                                                |
| 测试步骤     | \- 模拟APP发送有效业务数据包(payload≥2000字节，连续发送10个)到设备端 <br>- 模拟APP发送有效业务数据包（payload=1000字节），设备端响应成功、主动上报状态。 |
| 预期结果     | \- 系统成功接收并处理2000字节或者1000字节 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常                                            |
| 备注         |                                                                                                                                                       |

### 设备上电到联网成功时长

| 测试用例编号 | AOS-3-15                                                                            |
|--------------|-------------------------------------------------------------------------------------|
| 测试用例     | 设备上电到联网成功时长                                                              |
| 测试目的     | 验证设备从上电启动，到连接物联平台所耗时长，启动时间长短影响用户体验。              |
| 测试属性     | 必选 \| P1 \| 功能用例                                                              |
| 测试设备     | 1.设备，2.串口线，3.PC                                                              |
| 测试拓扑结构 | 一个设备串口连接PC，设备连接AP                                                      |
| 测试预置条件 | 设备联网并连接物联平台                                                              |
| 测试步骤     | \- 切断设备电源，再接通电源开始计时为A； <br>- 确认设备重启并成功连接物联平台的时间为B |
| 预期结果     | \- B-A≤15秒 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常        |
| 备注         |                                                                                     |

<a id="coap"></a>
## CoAP 通道测试规范

### 设备认证

| 测试用例编号 | AOS-3-28                                                                                                                                 |
|--------------|------------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备认证                                                                                                                                 |
| 测试目的     | 验证设备认证后获取iotid与iottoken                                                                                                        |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                                   |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                                   |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                       |
| 测试预置条件 | 设备联网成功                                                                                                                             |
| 测试步骤     | \- 设备尝试通过HTTPS认证 <br>- 设备连接CoAP服务器                                                                                           |
| 预期结果     | \-设备所支持的认证方式认证通过，拿到iotid和iottoken并且成功连接CoAP服务器 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异 |
| 备注         | CoAP支持HTTPS认证                                                                                                                        |

### 设备消息上行

| 测试用例编号 | AOS-3-29                                                                                                                           |
|--------------|------------------------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 设备消息上行                                                                                                                       |
| 测试目的     | 验证设备CoAP上行消息                                                                                                               |
| 测试属性     | 必选 \| P0 \| 功能用例                                                                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                                             |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                                 |
| 测试预置条件 | \- 设备联网成功 <br>- 设备认证成功                                                                                                    |
| 测试步骤     | 设备向topic A发送消息                                                                                                              |
| 预期结果     | \- 设备发布消息成功，服务日志查询的消息内容与设备发布的消息内容相同 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异 |
| 备注         | CoAP只支持上行                                                                                                                     |

### 设备反复认证

| 测试用例编号 | AOS-3-30                                                                             |
|--------------|--------------------------------------------------------------------------------------|
| 测试用例     | 设备反复认证                                                                         |
| 测试目的     | 验证设备反复认证稳定性                                                               |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                             |
| 测试设备     | 1.设备，2.串口线，3.PC                                                               |
| 测试拓扑结构 | 一个设备串口连接PC                                                                   |
| 测试预置条件 | 设备联网                                                                             |
| 测试步骤     | \- 设备认证 <br>- 设备向topic A发送消息 <br>- 步骤1\~2重复1W次                             |
| 预期结果     | \- 认证成功率≥99.9% <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                      |

### 低频CON消息

| 测试用例编号 | AOS-3-31                                                                                                        |
|--------------|-----------------------------------------------------------------------------------------------------------------|
| 测试用例     | 低频CON消息                                                                                                     |
| 测试目的     | 验证设备低频通信稳定性                                                                                          |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                        |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                          |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                              |
| 测试预置条件 | 设备联网                                                                                                        |
| 测试步骤     | \- 设备认证通过 <br>- 设备以500ms为周期向topic A发送消息 <br>- 使用工具统计topic A消息数量                            |
| 预期结果     | \- 24小时稳定工作 <br>- 丢包率≤1% <br>- 重连次数≤5次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                 |

###  长时间稳定通信

| 测试用例编号 | AOS-3-32                                                                                                            |
|--------------|---------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 长时间稳定通信                                                                                                      |
| 测试目的     | 验证设备CoAP大数据包稳定通信                                                                                        |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                            |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                              |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                                  |
| 测试预置条件 | 设备联网                                                                                                            |
| 测试步骤     | \- 设备认证成功 <br>- 设备以300s的周期向topic A发布消息 <br>- 使用工具统计topic A消息数量                                 |
| 预期结果     | \- 5x24小时稳定工作 <br>- 丢包率≤0.1% <br>- 重连次数≤3次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         |                                                                                                                     |

### 大数据包稳定通信

| 测试用例编号 | AOS-3-33                                                                                                         |
|--------------|------------------------------------------------------------------------------------------------------------------|
| 测试用例     | 大数据包稳定通信                                                                                                 |
| 测试目的     | 验证设备大数据包稳定通信                                                                                         |
| 测试属性     | 必选 \| P0 \| 稳定性用例                                                                                         |
| 测试设备     | 1.设备，2.串口线，3.PC                                                                                           |
| 测试拓扑结构 | 一个设备串口连接PC                                                                                               |
| 测试预置条件 | 设备联网                                                                                                         |
| 测试步骤     | \- 设备认证成功 <br>- 设备以500ms为周期向topic A发送2000字节的消息 <br>- 使用工具统计topic A消息数量                   |
| 预期结果     | \- 1小时稳定工作 <br>- 丢包率≤0.5% <br>- 重连次数≤1次 <br>- 系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常 |
| 备注         | 2000字节可以根据设备实际能力调整                                                                                 |

<a id="linkkit"></a>
## LinkKit 通道测试规范
* [AOS-3-34 设备认证及连接](#aos-3-34)
* [AOS-3-35 设置设备属性](#aos-3-35)
* [AOS-3-36 获取设备属性](#aos-3-36)
* [AOS-3-37 设备服务调用](#aos-3-37)
* [AOS-3-38 设备事件上报](#aos-3-38)
* [AOS-3-39 长时间连接稳定性](#aos-3-39)
* [AOS-3-40 长时间数据通信稳定性](#aos-3-40)
* [AOS-3-41 大数据包通信稳定](#aos-3-41)
* [AOS-3-42 断网发现与重连](#aos-3-42)
<a id='aos-3-34'></a>
### 设备认证及连接
<u>**用例编号**</u>：<u>AOS-3-34</u>
<br><u>**用例名称**</u>：设备认证及连接
<br><u>**测试目的**</u>：验证设备通过身份认证并成功连接到阿里云Link物联网平台
<br><u>**例属性**</u>：必选 | 功能
<br><u>**预置条件**</u>：
<br>1.从阿里云Link物联网平台申请合法设备
<br>2.设备通过命令行或者APP连上路由器（WiFi设备）
<br><u>**测试步骤**</u>：
<br>1.将设备三元组烧录至待测设备
<br>2.设备上电，观察设备串口日志
<br>3.登录一站式开发平台，查看设备在线状态
<br><u>**预期结果**</u>：
<br>1.设备串口日志显示连接成功
<br>2.一站式开发平台显示设备在线
<br>3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**备注**</u>：
<br>1.命令行配网：# netmgr connect {SSID} {PASSWD}
<br>2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-35'></a>
### 设置设备属性
<u>**用例编号**</u>：<u>AOS-3-35</u>
<br><u>**用例名称**</u>：设置设备属性
<br><u>**测试目的**</u>：验证设备能够接收服务端设置属性命令
<br><u>**用例属性**</u>：必选 | 功能
<br><u>**预置条件**</u>：设备连接至阿里云Link物联网平台
<br><u>**测试步骤**</u>：
<br>1.在阿里云一站式开发平台`调试设备`页面`设置`设备属性，属性的数据类型需要覆盖整型、浮点型、布尔型、字符串、枚举、时间类型、JSON
<br>2.观察设备串口日志，确定是否接收到该属性设置
<br>3.观察`调试设备`页面，确实是否显示设备下行和设备上行日志
<br><u>**预期结果**</u>：
<br>1.设备串口日志显示接收到属性设置，且属性值正确
<br>2.6中数据类型的属性全部支持
<br>3.`调试设备`页面显示设备下行和设备上行日志，日志中属性设置值正确
<br>4.设备响应时长 < 1s
<br>5.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**备注**</u>：
<br>1.设备响应时长计算：在`调试设备`页面观察设备下行和设备上行日志，结合日志时间戳计算响应时长
<br>2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-36'></a>
### 获取设备属性
<u>**用例编号**</u>：<u>AOS-3-36</u>
<br><u>**用例名称**</u>：获取设备属性
<br><u>**测试目的**</u>：验证能获取设备属性值
<br><u>**用例属性**</u>：必选 | 功能
<br><u>**预置条件**</u>：设备连接至阿里云Link物联网平台
<br><u>**测试步骤**</u>：
<br>1.在阿里云一站式开发平台`调试设备`页面`获取`设备属性，属性的数据类型需要覆盖整型、浮点型、布尔型、字符串、枚举、时间类型、JSON 
<br>2.观察`调试设备`页面，观察返回的设备属性JSON
<br><u>**预期结果**</u>：
<br>1.`调试设备`页面返回正确的设备属性值
<br>2.6中数据类型的属性全部支持
<br>3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**备注**</u>：服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-37'></a>
### 设备服务调用
<u>**用例编号**</u>：<u>AOS-3-37</u>
<br><u>**用例名称**</u>：设备服务调用
<br><u>**测试目的**</u>：验证设备响应服务端的服务调用
<br><u>**用例属性**</u>：必选 | 功能
<br><u>**预置条件**</u>：
<br>1.设备连接至阿里云Link物联网平台
<br>2.设备支持服务
<br><u>**测试步骤**</u>：
<br>1.在阿里云一站式开发平台`调试设备`页面，输入服务的输入参数，调用服务
<br>2.观察设备串口日志，确定是否接收到该服务调用
<br>3.在`设备详情`->`服务调用`页面查看服务调用记录
<br><u>**预期结果**</u>：
<br>1.设备串口显示接收到服务调用，且输入参数符合预期
<br>2.服务调用记录显示服务调用成功
<br>3.设备响应时长 < 1s
<br>4.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**备注**</u>：
<br>1.设备响应时长计算：在`调试设备`页面观察设备下行日志和服务调用记录时间戳计算响应时长
<br>2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-38'></a>
### 设备事件上报
<u>**用例编号**</u>：<u>AOS-3-38</u>
<br><u>**用例名称**</u>：设备事件上报
<br><u>**测试目的**</u>：验证设备支持主动上报事件
<br><u>**用例属性**</u>：必选 | 功能
<br><u>**预置条件**</u>：
<br>1.设备连接至阿里云Link物联网平台
<br>2.设备支持通过硬件按键触发事件上报
<br><u>**测试步骤**</u>：
<br>1.物理按键，触发事件
<br>2.`设备详情`->`事件管理`页面查看设备事件管理
<br><u>**预期结果**</u>：
<br>1.设备事件管理列表显示最近一次事件调用
<br>2.事件上报时长 < 1s
<br>3.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**备注**</u>：
<br>1.事件上报时长计算：设备端日志时间戳与服务端时间管理列表时间戳之差
<br>2.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-39'></a>
### 长时间连接稳定性
<u>**用例编号**</u>：<u>AOS-3-39</u>
<br><u>**用例名称**</u>：长时间连接稳定性
<br><u>**测试目的**</u>：验证物联网设备与阿里云长时间连接稳定可靠
<br><u>**用例属性**</u>：必选 | 稳定性
<br><u>**预置条件**</u>：
<br>1.设备连接至阿里云Link物联网平台
<br>2.网络环境长时间稳定可靠
<br><u>**测试步骤**</u>：
<br>1.设备上电，页面上确定设备上线，静置 5x24 小时
<br>2.使用串口工具将设备串口日志定向到文件
<br>3.5x24 小时后查看设备日志，选择设备上线日志、测试时间段，确定测试时间段内设备上线次数
<br>4.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**预期结果**</u>：
<br>1.5x24小时内设备离线次数≤3次
<br><u>**备注**</u>：服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-40'></a>
###  长时间数据通信稳定性
<u>**用例编号**</u>：<u>AOS-3-40</u>
<br><u>**用例名称**</u>：长时间数据通行稳定性
<br><u>**测试目的**</u>：验证物联网设备与阿里云长时间数据通信稳定性
<br><u>**用例属性**</u>：必选 | 稳定性、性能
<br><u>**预置条件**</u>：
<br>1.设备连接至阿里云Link物联网平台
<br>2.网络环境长时间稳定可靠
<br><u>**测试步骤**</u>：
<br>1.设备上电，页面上确定设备上线，静置 12 小时
<br>2.使用串口工具将设备串口日志定向到文件
<br>3.使用压测工具向该设备发送消息，发送周期为500ms
<br>4.12 小时后查看压测工具，检查设备离线次数、丢包率
<br>5.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**预期结果**</u>：
<br>1.设备离线次数≤1次
<br>2.成功率≥99%
<br><u>**备注**</u>：
<br>1.压测工具使用操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-41'></a>
### 大数据包通信稳定
<u>**用例编号**</u>：<u>AOS-3-41</u>
<br><u>**用例名称**</u>：大数据包通信稳定
<br><u>**测试目的**</u>：验证设备在数据量较大情况下能长时间稳定通信
<br><u>**用例属性**</u>：必选 | 稳定性
<br><u>**预置条件**</u>：设备连接至阿里云Link物联网平台
<br><u>**测试步骤**</u>：
<br>1.设备上电，页面上确认设备上线，静置 1 小时
<br>2.使用串口工具将设备串口日志定向到文件
<br>3.使用压测工具向该设备发送字符串类型数据，字符串长度为256字节，发送周期为500ms
<br>4.1小时后查看压测工具，检查设备离线次数、丢包率
<br>5.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异常
<br><u>**预期结果**</u>：
<br>1.压测期间无离线
<br>2.成功率100%
<br><u>**备注**</u>：
<br>1.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)

<a id='aos-3-42'></a>
### 断网发现与重连
<u>**用例编号**</u>：<u>AOS-3-42</u>
<br><u>**用例名称**</u>：断网发现与重连
<br><u>**测试目的**</u>：验证设备在网络断开的情况下能发现网络异常并尝试重新连接阿里云
<br><u>**用例属性**</u>：必选 | 稳定性
<br><u>**预置条件**</u>：设备连接至阿里云Link物联网平台
<br><u>**测试步骤**</u>：
<br>1.待设备连接至阿里云Link物联网平台后，维持至少一个心跳周期
<br>2.断开网络（断开AP LAN口），保持设备与AP的连接
<br>3.观察设备串口日志判断设备是否尝试重连
<br>4.一个心跳周期后会恢复网络连接
<br>5.产看服务端设备在线状态
<br>6.系统无crash，fail，error，assert，abort，内存泄漏，阻塞等异
<br><u>**预期结果**</u>：
<br>1.3个心跳周期内，设备发现网络断开并尝试重连
<br>2.网络恢复后1个心跳周期内设备重新上线
<br><u>**备注**</u>：
<br>1.服务端相关操作详见[LinkKit通道测试指南](Manual-Channel-LinkKit)